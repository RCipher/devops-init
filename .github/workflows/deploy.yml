name: üöÄ Deploy to MyPC

on:
  push:
    branches:
      - main   # –¢—Ä–∏–≥–≥–µ—Ä ‚Äî –ø—É—à –≤ –≤–µ—Ç–∫—É main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub runner (–Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–¥—É)
      - name: Checkout repo
        uses: actions/checkout@v3

      # 2. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–æ SSH –∏ –¥–µ–ø–ª–æ–∏–º
      - name: Deploy via SSH
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.SERVER_HOST }}       # tcp.cloudpub.ru
          port: ${{ secrets.SERVER_PORT }}       # 39681
          username: ${{ secrets.SERVER_USER }}   # —Ç–≤–æ–π user
          key: ${{ secrets.SERVER_SSH_KEY }}     # –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
          script: |
            echo "üîπ –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É!"
            cd ~/devops_start || exit 1
            echo "üîπ –¢—è–Ω–µ–º —Å–≤–µ–∂–∏–π –∫–æ–¥ –∏–∑ GitHub..."
            git pull origin main
            echo "üîπ –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
            docker-compose up -d --build
            echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω!"

